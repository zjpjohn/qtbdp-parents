<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">

<head>
    <meta charset="utf-8" />
    <title>数据商城管理-8数据分类目录设置</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta content="" name="description" />
    <meta content="" name="author" />
    <meta http-equiv="cache-control" content="no-cache" />
    <link th:href="@{/css/font-awesome.min.css}" rel="stylesheet" type="text/css" />
    <link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="/css/components.min.css" rel="stylesheet" id="style_components" type="text/css" />
    <link href="/css/layout.css" rel="stylesheet" type="text/css" />
    <link href="/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css">
    <link href="/css/plugins.min.css" rel="stylesheet" type="text/css">
    <link href="/css/darkblue.min.css" rel="stylesheet" type="text/css" id="style_color">
    <script src="/js/jquery.min.js" type="text/javascript"></script>
    <script src="/js/template.min.js"></script>
    <script src="/js/layer.js"></script>


</head>

<style>
    .dataname{
        cursor:pointer;
        padding-left: 15px;
    }

</style>



<body class="page-header-fixed page-sidebar-closed-hide-logo page-content-white">

<!--  页头 -->
<div th:replace="layout/header"/></div>
<!-- 页头结束 -->


<div class="clearfix"> </div>

<div class="page-container">
    <!--侧边栏-->
    <div th:replace="layout/sidebar" /></div>
<!--侧边栏结束-->

<!--主体内容-->
<div class="page-content-wrapper">
    <div class="page-content" style="min-height: 1095px;">
        <!--面包屑-->
        <div class="page-bar">
            <ul class="page-breadcrumb">
                <li>
                    <span>数据商城管理</span>
                    <i class="fa fa-circle"></i>
                </li>
                <li>
                    <a href="#" class="active">数据分类目录设置</a>
                </li>
            </ul>
        </div>
        <!--面包屑结束-->
        <div class="portlet light portlet-fit portlet-datatable">
            <p><a href="javascript:;"> 菜单添加 </a></p>

            <div class="portlet-body">
                <table class="table table-striped table-bordered table-hover dt-responsive" width="100%" id="tableMenu">
                    <thead>
                        <tr>
                            <th class="all">分类名称</th>

                            <th class="none">可见</th>


                            <th class="none">操作</th>

                        </tr>
                    </thead>
                    <tbody id="tableClassify" class="twoClassify addtr">
                        <!--<tr>
                            <td>Tiger</td>
                            <td>Nixon</td>
                            <td>System Architect</td>
                            <td>Edinburgh</td>
                            <td>61</td>
                            <td>2011/04/25</td>
                            <td>$320,800</td>
                            <td>5421</td>
                        </tr>-->


                    </tbody>
                </table>
            </div>


        </div>

    </div>
    <!--主体内容结束-->
</div>

<div id="updatePop" class="modal fade" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <div class="row">
                    <h2>修改菜单</h2>
                </div>
            </div>
            <div class="modal-body">
                <div id="tree_1" class="tree-demo">
                </div>
            </div>

        </div>
    </div>
</div>


<script src="/js/bootstrap.min.js" type="text/javascript"></script>
<script src="/js/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>

<script src="/js/app.min.js" type="text/javascript"></script>

<script src="/js/jquery.blockui.min.js" type="text/javascript"></script>
<script src="/js/jquery.uniform.min.js" type="text/javascript"></script>
<script src="/js/jquery.validate.js" type="text/javascript"></script>
<script src="/js/layer.js" type="text/javascript"></script>
<script src="/js/layout.js" type="text/javascript"></script>
<script src="/js/jquery.tmpl.min.js" type="text/javascript"></script>

<!--<script src="/js/shopManage/wares.js"></script>-->




<script>
//页面加载获取的数据
    $(function(){
        $.ajax({
            url: "/api/dataType/findRootNode",
            type: "get",
            success: function (data) {
                var html="";
                console.log(data);
                for(var i=0;i<data.pageInfo.list.length;i++){
                    html+='<tr data-id="'+data.pageInfo.list[i].id+'" data-isUsed="'+data.pageInfo.list[i].isUsed+'"   >\
                        <td  class="dataname">'+data.pageInfo.list[i].name+'</td>\
                        <td>可见</td>\
                        <td> <a href="javadcript:;" class="editor">修改</a>  <a href="javascript:;" class="addmenu">添加下级菜单</a></td>\
                    </tr>'
                }
                $("#tableClassify").html(html);
            }
        })
    });
//点击一级分类展现二级分类
    $("#tableClassify").unbind("click").on("click",".dataname",function(){
        //$("p").slideToggle();
        var dataid=$(this).parent().attr("data-id");
        var isUsed=$(this).parent().attr("data-isUsed");

        var me=this;
        if(!$(me).hasClass("disabled")){
            $.ajax({
                url: "/api/dataType/findSecondNode",
                type: "get",
                data:{
                    id:dataid,
                    isUsed:isUsed,
                },
                success: function (data) {
                    var html2="";
                    console.log(data);
                    console.log(isUsed);
                    console.log(dataid);

                    for(var i=0;i<data.pageInfo.list.length;i++){
                        html2+='<tr class="disableds"  data-id="'+data.pageInfo.list[i].id+'" data-isUsed="'+data.pageInfo.list[i].isUsed+'"  data-pid="'+data.pageInfo.list[i].pid+'" >\
                        <td class="dataname" style="padding-left: 50px;">'+data.pageInfo.list[i].name+'</td>\
                        <td >可见</td>\
                        <td> <a href="javadcript:;"  class="editor">修改</a>  </td>\
                        </tr>'
                    }
                    $(me).parent().after(html2);
                    $(me).addClass("disabled");
                }
            })
        }else{
            $('tr[data-pid='+dataid+']').slideUp();
            $(me).removeClass("disabled");
        }
    });
//点击一级类目编辑
    $("#tableMenu").unbind("click").on("click",".editor",function(){
        var dataid=$(this).parent().parent().attr("data-id");
        var isUsed=$(this).parent().parent().attr("data-isUsed");
        var html3=""
        $.ajax({
            url: "/api/dataType/findDataTypById",
            type: "get",
            data:{
                id:dataid,
                isUsed:isUsed,
            },
            success: function (data) {
                console.log(data);
                console.log(dataid);
                console.log(isUsed);

                html3=' <div class="row">\
                    <h4>修改菜单</h4>\
                    </div>\
                    <form class="form-horizontal">\
                        <div class="form-group">\
                            <label class="col-md-3 control-label">名称 </label>\
                            <div class="col-md-9">\
                            <input name="name" value="'+data.pageInfo.name+'" class=" form-control input-small "  type="text" />\
                            </div>\
                        </div>\
                        <div class="form-group">\
                            <label class="col-md-3 control-label">可见 </label>\
                            <div class="col-md-9" style="padding-top:8px;">'
                            if(isUsed==1){
                                html3+= '<label><input name="yes" type="radio" checked="checked" />是</label>\
                                <label><input name="yes" type="radio" />否</label>'
                            }else{
                                html3+= '<label><input name="yes" type="radio" />是</label>\
                                <label><input name="yes" type="radio" checked="checked" />否</label>'
                            }

                        html3+='</div>\
                        </div>\
                        <form >';

                layer.open({
                    title:false,
                    type: 0,
                    //skin: 'layui-layer-rim', //加上边框
                    area: ['400px', '300px'], //宽高
                    content: html3,
                    yes: function(){

                        $.ajax({
                            url: "/api/dataType/insertDataType",
                            type: "put",
                            success: function (data) {
                                window.location.reload();//刷新

                            },
                            error:function(){
                                layer.msg(data.msg?data.msg:'操作失败!', {icon: 5});

                            }
                        })
                    }
                });

            }
        })
    });

 //点击下级菜单
    $(".addtr").unbind("click").on("click",".addmenu",function(){
        var dataid=$(this).parent().parent().attr("data-id");
        var isUsed=$(this).parent().parent().attr("data-isUsed");
        var html4=""
        $.ajax({
            url: "/api/dataType/findDataTypById",
            type: "get",
            data:{
                id:dataid,
                isUsed:isUsed,
            },
            success: function (data) {
                console.log(data);
                console.log(dataid);
                console.log(isUsed);

                html4=' <div class="row">\
                    <h4>修改菜单</h4>\
                    </div>\
                    <form class="form-horizontal">\
                        <div class="form-group">\
                            <label class="col-md-3 control-label">名称 </label>\
                            <div class="col-md-9">\
                            <input name="name" value="" class=" form-control input-small "  type="text" />\
                            </div>\
                        </div>\
                        <div class="form-group">\
                            <label class="col-md-3 control-label">可见 </label>\
                            <div class="col-md-9" style="padding-top:8px;">\
                            <label><input name="yes" type="radio"  />是</label>\
                            <label><input name="yes" type="radio" />否</label>\
                        </div>\
                        </div>\
                        <form >';

                layer.open({
                    title:false,
                    type: 0,
                    //skin: 'layui-layer-rim', //加上边框
                    area: ['400px', '300px'], //宽高
                    content: html4,
                    yes: function(){

                        $.ajax({
                            url: "/api/dataType/insertDataType",
                            type: "post",
                            success: function (data) {
                                window.location.reload();//刷新

                            },
                            error:function(){
                                layer.msg(data.msg?data.msg:'操作失败!', {icon: 5});

                            }
                        })
                    }
                });

            }
        })



    });


</script>

</body>
</html>









